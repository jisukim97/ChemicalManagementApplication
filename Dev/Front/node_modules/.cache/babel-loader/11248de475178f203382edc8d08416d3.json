{"ast":null,"code":"var _jsxFileName = \"/Users/yeongmo/Documents/Programming/timeline/timeline/src/components/ForgotPassword.js\";\nimport React, { Component } from 'react';\nimport { Form, Icon, Input, Button, message } from 'antd';\nimport { Link } from \"react-router-dom\";\nimport { history } from '../History';\nimport { serverUrl } from '../setting';\n\nclass ForgotPassword extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      visibleEmail: true,\n      visibleQuestion: false,\n      visibleReset: false,\n      question: \"\",\n      email: \"\" //이메일 입력 하고 버튼을 눌렀을 때 : 비밀번호 초기화 질문을 불러와서 물어본다\n\n    };\n\n    this.emailSubmit = e => {\n      e.preventDefault(); //이메일 주소 입력해서 이메일을 가진 회원이 존재하는지 확인. 확인 되면, 비밀번호 질문을 불러온다\n\n      this.props.form.validateFields((err, values) => {\n        if (!err) {\n          //http요청\n          fetch(serverUrl + '/login/forgot/question', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify(values)\n          }).then(response => {\n            const result = response.status;\n\n            if (result === 200) {\n              //이메일이 존재 할 경우 성공하였을 경우\n              //질문을 받아오고, 대답을 입력하는 폼을 보여준다. \n              response.json().then(response => {\n                console.log(\"@@@@@@\");\n                console.log(response);\n                this.setState({\n                  question: response.question,\n                  visibleEmail: false,\n                  visibleQuestion: true,\n                  email: values.email\n                });\n              });\n            } else if (result === 403) {\n              //이메일이 존재하지 않음\n              message.error(\"이메일이 존재하지 않습니다!\");\n            } else {//내부 오류\n            }\n          });\n        }\n      });\n    };\n\n    this.emailForm = () => {\n      const getFieldDecorator = this.props.form.getFieldDecorator;\n      return React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 63\n        },\n        __self: this\n      }, React.createElement(Form, {\n        onSubmit: this.emailSubmit,\n        className: \"form\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 64\n        },\n        __self: this\n      }, React.createElement(Form.Item, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 65\n        },\n        __self: this\n      }, \"\\uC774\\uBA54\\uC77C \\uC8FC\\uC18C\\uB97C \\uC785\\uB825 \\uD574 \\uC8FC\\uC138\\uC694\", getFieldDecorator('email', {\n        rules: [{\n          required: true,\n          message: '이메일 주소를 입력 해 주세요!'\n        }]\n      })(React.createElement(Input, {\n        prefix: React.createElement(Icon, {\n          type: \"mail\",\n          style: {\n            color: 'rgba(0,0,0,.25)'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 71\n          },\n          __self: this\n        }),\n        placeholder: \"Email\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 70\n        },\n        __self: this\n      }))), React.createElement(Form.Item, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 76\n        },\n        __self: this\n      }, React.createElement(Button, {\n        type: \"primary\",\n        htmlType: \"submit\",\n        className: \"button\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 77\n        },\n        __self: this\n      }, \"Submit Email Address\"), \"Or \", React.createElement(Link, {\n        to: \"/login\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 80\n        },\n        __self: this\n      }, \"login now!\"))));\n    };\n\n    this.questionSubmit = e => {\n      e.preventDefault();\n      this.props.form.validateFields((err, values) => {\n        if (!err) {\n          //http요청\n          fetch(serverUrl + '/login/forgot/answer', {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              answer: values.answer,\n              email: this.state.email\n            })\n          }).then(response => {\n            const result = response.status;\n\n            if (result === 200) {\n              //성공하였을 경우 : 비밀번호 초기화 폼을 보여준다\n              this.setState({\n                visibleQuestion: false,\n                visibleReset: true\n              });\n            } else if (result === 403) {\n              //답이 틀림\n              message.error(\"정답이 일치하지 않습니다!\");\n            } else {//내부 오류\n            }\n          });\n        }\n      });\n    };\n\n    this.questionForm = () => {\n      const getFieldDecorator = this.props.form.getFieldDecorator;\n      return React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 124\n        },\n        __self: this\n      }, React.createElement(Form, {\n        onSubmit: this.questionSubmit,\n        className: \"form\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 125\n        },\n        __self: this\n      }, React.createElement(Form.Item, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 126\n        },\n        __self: this\n      }, this.state.question, getFieldDecorator('answer', {\n        rules: [{\n          required: true,\n          message: '대답을 입력 해 주세요!'\n        }]\n      })(React.createElement(Input, {\n        prefix: React.createElement(Icon, {\n          type: \"question\",\n          style: {\n            color: 'rgba(0,0,0,.25)'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 132\n          },\n          __self: this\n        }),\n        placeholder: \"Answer\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 131\n        },\n        __self: this\n      }))), React.createElement(Form.Item, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 138\n        },\n        __self: this\n      }, React.createElement(Button, {\n        type: \"primary\",\n        htmlType: \"submit\",\n        className: \"button\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 139\n        },\n        __self: this\n      }, \"Submit Answer\"), \"Or \", React.createElement(Link, {\n        to: \"/login\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 142\n        },\n        __self: this\n      }, \"login now!\"))));\n    };\n\n    this.compareToFirstPassword = (rule, value, callback) => {\n      const form = this.props.form;\n\n      if (value && value !== form.getFieldValue('password')) {\n        callback('두 비밀번호가 일치하지 않습니다!');\n      } else {\n        callback();\n      }\n    };\n\n    this.validateToNextPassword = (rule, value, callback) => {\n      const form = this.props.form;\n      form.validateFields(['confirm'], {\n        force: true\n      });\n      callback();\n    };\n\n    this.resetSubmit = e => {\n      e.preventDefault();\n      this.props.form.validateFields((err, values) => {\n        if (!err) {\n          console.log('Received values of form: ', values);\n          fetch(serverUrl + '/login/forgot/reset', {\n            method: 'PUT',\n            headers: {\n              'Content-Type': 'application/json'\n            },\n            body: JSON.stringify({\n              email: this.state.email,\n              password: values.password\n            })\n          }).then(response => {\n            const result = response.status;\n\n            if (result === 200) {\n              //리셋이 성공하였을 경우\n              message.success(\"비밀번호 변경에 성공하였습니다. 로그인 페이지로 돌아갑니다!\");\n              history.push('/login');\n            } else {\n              //내부 오류\n              console.log(result);\n            }\n          });\n        }\n      });\n    };\n\n    this.resetForm = () => {\n      const getFieldDecorator = this.props.form.getFieldDecorator;\n      return React.createElement(\"span\", {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 199\n        },\n        __self: this\n      }, React.createElement(Form, {\n        onSubmit: this.resetSubmit,\n        className: \"form\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 200\n        },\n        __self: this\n      }, \"\\uC0C8\\uB85C\\uC6B4 \\uBE44\\uBC00\\uBC88\\uD638\\uB97C \\uC785\\uB825\\uD574 \\uC8FC\\uC138\\uC694\", React.createElement(Form.Item, {\n        hasFeedback: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 202\n        },\n        __self: this\n      }, getFieldDecorator('password', {\n        rules: [{\n          required: true,\n          message: '비밀번호를 입력 해 주세요!'\n        }, {\n          validator: this.validateToNextPassword\n        }]\n      })(React.createElement(Input.Password, {\n        prefix: React.createElement(Icon, {\n          type: \"lock\",\n          style: {\n            color: 'rgba(0,0,0,.25)'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 214\n          },\n          __self: this\n        }),\n        placeholder: \"Password\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 213\n        },\n        __self: this\n      }))), React.createElement(Form.Item, {\n        hasFeedback: true,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 217\n        },\n        __self: this\n      }, getFieldDecorator('confirm', {\n        rules: [{\n          required: true,\n          message: '비밀번호를 다시 한번 입력 해 주세요!'\n        }, {\n          validator: this.compareToFirstPassword\n        }]\n      })(React.createElement(Input.Password, {\n        prefix: React.createElement(Icon, {\n          type: \"lock\",\n          style: {\n            color: 'rgba(0,0,0,.25)'\n          },\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 229\n          },\n          __self: this\n        }),\n        placeholder: \"Confirm password\",\n        onBlur: this.handleConfirmBlur,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 228\n        },\n        __self: this\n      }))), React.createElement(Form.Item, {\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 233\n        },\n        __self: this\n      }, React.createElement(Button, {\n        type: \"primary\",\n        htmlType: \"submit\",\n        className: \"button\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 234\n        },\n        __self: this\n      }, \"Reset Password\"), \"Or \", React.createElement(Link, {\n        to: \"/login\",\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 237\n        },\n        __self: this\n      }, \"login now!\"))));\n    };\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }, this.state.visibleEmail && this.emailForm(), this.state.visibleQuestion && this.questionForm(), this.state.visibleReset && this.resetForm());\n  }\n\n}\n\nexport default Form.create()(ForgotPassword);","map":{"version":3,"sources":["/Users/yeongmo/Documents/Programming/timeline/timeline/src/components/ForgotPassword.js"],"names":["React","Component","Form","Icon","Input","Button","message","Link","history","serverUrl","ForgotPassword","state","visibleEmail","visibleQuestion","visibleReset","question","email","emailSubmit","e","preventDefault","props","form","validateFields","err","values","fetch","method","headers","body","JSON","stringify","then","response","result","status","json","console","log","setState","error","emailForm","getFieldDecorator","rules","required","color","questionSubmit","answer","questionForm","compareToFirstPassword","rule","value","callback","getFieldValue","validateToNextPassword","force","resetSubmit","password","success","push","resetForm","validator","handleConfirmBlur","render","create"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport { Form, Icon, Input, Button, message } from 'antd';\nimport { Link } from \"react-router-dom\";\n\nimport { history } from '../History';\nimport { serverUrl } from '../setting'\n\nclass ForgotPassword extends Component {\n\n    //visibleEmail : 이메일 입력 폼\n    //visibieQuestion : 이메일이 성공적으로 확인되었을 때, 질문에 대한 답을 입력하는 폼\n    //visibleReset : 비밀번호 리셋 질문이 성공하였을 때 리셋하기 위한 폼\n    state = {\n        visibleEmail: true,\n        visibleQuestion: false,\n        visibleReset : false,\n        question :\"\",\n        email:\"\"\n    }\n\n    //이메일 입력 하고 버튼을 눌렀을 때 : 비밀번호 초기화 질문을 불러와서 물어본다\n    emailSubmit = e => {\n        e.preventDefault();\n        //이메일 주소 입력해서 이메일을 가진 회원이 존재하는지 확인. 확인 되면, 비밀번호 질문을 불러온다\n        this.props.form.validateFields((err, values) => {\n            if (!err) {\n                //http요청\n                fetch(serverUrl + '/login/forgot/question', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify(values)\n                })\n                    .then(response => {\n                        const result = response.status;\n                        if (result === 200) {\n                            //이메일이 존재 할 경우 성공하였을 경우\n                            //질문을 받아오고, 대답을 입력하는 폼을 보여준다. \n                            response.json().then(response => {\n                                console.log(\"@@@@@@\");\n                                console.log(response)\n                                this.setState({\n                                    question : response.question,\n                                    visibleEmail : false,\n                                    visibleQuestion : true,\n                                    email : values.email\n                                })\n                            })\n                        } else if (result === 403) {\n                            //이메일이 존재하지 않음\n                            message.error(\"이메일이 존재하지 않습니다!\")\n                        } else {\n                            //내부 오류\n                        }\n                    })\n            }\n        });\n    };\n\n    //이메일 주소 입력하는 폼\n    emailForm = () => {\n        const { getFieldDecorator } = this.props.form;\n        return (\n            <span>\n                <Form onSubmit={this.emailSubmit} className=\"form\">\n                    <Form.Item>\n                        이메일 주소를 입력 해 주세요\n                        {getFieldDecorator('email', {\n                            rules: [{ required: true, message: '이메일 주소를 입력 해 주세요!' }],\n                        })(\n                            <Input\n                                prefix={<Icon type=\"mail\" style={{ color: 'rgba(0,0,0,.25)' }} />}\n                                placeholder=\"Email\"\n                            />,\n                        )}\n                    </Form.Item>\n                    <Form.Item>\n                        <Button type=\"primary\" htmlType=\"submit\" className=\"button\">\n                            Submit Email Address\n                        </Button>\n                        Or <Link to=\"/login\">login now!</Link>\n                    </Form.Item>\n                </Form >\n            </span>\n        );\n    }\n\n    //질문에 대한 답 입력 하고 버튼을 눌렀을 때 : 맞다면 비밀번호 초기화 폼을 불러온다\n    questionSubmit = e => {\n        e.preventDefault();\n        this.props.form.validateFields((err, values) => {\n            if (!err) {\n                //http요청\n                fetch(serverUrl + '/login/forgot/answer', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        answer : values.answer,\n                        email : this.state.email\n                    })\n                })\n                    .then(response => {\n                        const result = response.status;\n                        if (result === 200) {\n                            //성공하였을 경우 : 비밀번호 초기화 폼을 보여준다\n                            this.setState({\n                                visibleQuestion : false,\n                                visibleReset : true\n                            })\n                        } else if (result === 403) {\n                            //답이 틀림\n                            message.error(\"정답이 일치하지 않습니다!\")\n                        } else {\n                            //내부 오류\n                        }\n                    })\n            }\n        });\n    };\n\n    //질문에 대한 답을 입력하는 폼\n    questionForm = () => {\n        const { getFieldDecorator } = this.props.form;\n        return (\n            <span>\n                <Form onSubmit={this.questionSubmit} className=\"form\">\n                    <Form.Item>\n                        {this.state.question}\n                        {getFieldDecorator('answer', {\n                            rules: [{ required: true, message: '대답을 입력 해 주세요!' }],\n                        })(\n                            <Input\n                                prefix={<Icon type=\"question\" style={{ color: 'rgba(0,0,0,.25)' }} />}\n                                placeholder=\"Answer\"\n                            />,\n                        )}\n                    </Form.Item>\n\n                    <Form.Item>\n                        <Button type=\"primary\" htmlType=\"submit\" className=\"button\">\n                            Submit Answer\n                        </Button>\n                        Or <Link to=\"/login\">login now!</Link>\n                    </Form.Item>\n                </Form >\n            </span>\n        );\n    }\n\n    //비밀번호 두개 일치하는지 확인\n    compareToFirstPassword = (rule, value, callback) => {\n        const { form } = this.props;\n        if (value && value !== form.getFieldValue('password')) {\n            callback('두 비밀번호가 일치하지 않습니다!');\n        } else {\n            callback();\n        }\n    };\n\n    //비밀번호 검증 과정인데 따로 규칙 지정 안했으므로 항상 true\n    validateToNextPassword = (rule, value, callback) => {\n        const { form } = this.props;\n        form.validateFields(['confirm'], { force: true });\n        callback();\n    };\n\n    //비밀번호 초기화\n    resetSubmit = e => {\n        e.preventDefault();\n        this.props.form.validateFields((err, values) => {\n            if (!err) {\n                console.log('Received values of form: ', values);\n                fetch(serverUrl + '/login/forgot/reset', {\n                    method: 'PUT',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        email : this.state.email,\n                        password : values.password\n                    })\n                })\n                    .then(response => {\n                        const result = response.status;\n                        if (result === 200) {\n                            //리셋이 성공하였을 경우\n                            message.success(\"비밀번호 변경에 성공하였습니다. 로그인 페이지로 돌아갑니다!\")\n                            history.push('/login')\n                        } else {\n                            //내부 오류\n                            console.log(result)\n                        }\n                    })\n            }\n        });\n    };\n\n    //비밀번호 초기화 폼\n    resetForm = () => {\n        const { getFieldDecorator } = this.props.form;\n        return (\n            <span>\n                <Form onSubmit={this.resetSubmit} className=\"form\">\n                새로운 비밀번호를 입력해 주세요\n                <Form.Item hasFeedback>\n                    {getFieldDecorator('password', {\n                        rules: [\n                            {\n                                required: true,\n                                message: '비밀번호를 입력 해 주세요!',\n                            },\n                            {\n                                validator: this.validateToNextPassword,\n                            },\n                        ],\n                    })(<Input.Password\n                        prefix={<Icon type=\"lock\" style={{ color: 'rgba(0,0,0,.25)' }} />}\n                        placeholder=\"Password\" />)}\n                </Form.Item>\n                <Form.Item hasFeedback>\n                    {getFieldDecorator('confirm', {\n                        rules: [\n                            {\n                                required: true,\n                                message: '비밀번호를 다시 한번 입력 해 주세요!',\n                            },\n                            {\n                                validator: this.compareToFirstPassword,\n                            },\n                        ],\n                    })(<Input.Password\n                        prefix={<Icon type=\"lock\" style={{ color: 'rgba(0,0,0,.25)' }} />}\n                        placeholder=\"Confirm password\"\n                        onBlur={this.handleConfirmBlur} />)}\n                </Form.Item>\n                    <Form.Item>\n                        <Button type=\"primary\" htmlType=\"submit\" className=\"button\">\n                            Reset Password\n                        </Button>\n                        Or <Link to=\"/login\">login now!</Link>\n                    </Form.Item>\n                </Form >\n            </span>\n        );\n    }\n\n    render() {\n        return (\n            <div>\n                {this.state.visibleEmail && this.emailForm()}\n                {this.state.visibleQuestion && this.questionForm()}\n                {this.state.visibleReset && this.resetForm()}\n            </div>\n        );\n    }\n}\n\nexport default Form.create()(ForgotPassword);\n"]},"metadata":{},"sourceType":"module"}